<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domácí rozpočet</title>
</head>
<body style="background-color: lightgreen;">
<p>Výběr role
    <select id="role" onchange="zmen_roli()">
        <option value="uzivatel">Uživatel</option>
        <option value="admin">Správce rozpočtu</option>
    </select>
    </p>
    <h1><u>Aplikace pro domácí rozpočet</u></h1>
    <h2>Přehled</h2>
    <p>Stav účtu: <span id="stav_uctu">0</span></p>

<h3>Seznam kategorií</h3>

<table border="1" cellpadding="8" cellspacing="0" bgcolor="white">
<thead bgcolor="#4CAF50">
    <tr>
        <th>Název kategorie</th>
        <th>Typ transakce (příjem / výdaj)</th>
        <th>Akce</th>
    </tr>
</thead>
<tbody id="tabulka_kategorie"></tbody>
</table>

<p>Název kategorie 
<input id="nazev_kategorie" type="text">
<select id="typ_transakce">
    <option value="prijem">Příjem</option>
    <option value="vydaj">Výdaj</option>
</select>
<button onclick="pridej_kategorii()">Přidat kategorii</button>
</p>

<h3>Poslední transakce</h3>
<table border="1" cellpadding="8" cellspacing="0" bgcolor="white">
  <thead bgcolor="#4CAF50">
    <tr>
      <th>Popis</th>
      <th>Částka</th>
      <th>Kategorie</th>
      <th>Typ</th>
      <th>Akce</th>
    </tr>
  </thead>
  <tbody id="posledni_transakce">
  </tbody>
</table>

<p>
Název položky <input id="nazev_polozky" type="text">
Částka <input id="castka" type="text">
<select id="kategorie_polozky"></select>
<button onclick="pridej_polozku()">Přidat položku</button>
</p>

<br> <br>
<div class="admin"> 
<button onclick="vymazani_localstorage()">Smazat localStorage</button>
</div>


<script src="tridy.js"></script>

<script>
  let kategorie = JSON.parse(localStorage.getItem("kategorie")) || [];
  let polozky = JSON.parse(localStorage.getItem("polozky")) || [];

  function uloz() {
    localStorage.setItem("kategorie", JSON.stringify(kategorie));
    localStorage.setItem("polozky", JSON.stringify(polozky));
  }

  function nacteni_kategorii() {
    let tk = document.getElementById("tabulka_kategorie");
    tk.innerHTML = "";
    for (let i = 0; i < kategorie.length; i++) {
      let tr = document.createElement("tr");
       tr.innerHTML = `<td>${kategorie[i].nazev}</td><td>${kategorie[i].typ}</td><td><div class="admin"><button onclick="smaz_kategorii(${i})">Smazat</div></button></td>`;
      tk.appendChild(tr);
    }

    let sel = document.getElementById("kategorie_polozky");
    sel.innerHTML = "";
    for (let i = 0; i < kategorie.length; i++) {
      sel.innerHTML += `<option value="${kategorie[i].nazev}">${kategorie[i].nazev}</option>`;
    }
  }

function vykresli_polozky() {
  let t = document.getElementById("posledni_transakce");
  t.innerHTML = "";

  for (let i = polozky.length - 1; i >= 0; i--) {
    let p = polozky[i];
    t.innerHTML +=
      `<tr><td>${p.nazev}</td><td>${p.castka}</td><td>${p.kategorie}</td><td>${p.typ}</td>` +
      `<td><button onclick="smaz_polozku(${i})">Smazat</button></td></tr>`;
  }

  let stav = 0;
  for (let i = 0; i < polozky.length; i++) {
    let c = Number(polozky[i].castka) || 0;
    stav += (polozky[i].typ === "prijem") ? c : -c;
  }
  document.getElementById("stav_uctu").innerText = stav;
}

  function pridej_kategorii() {
    let nazev = document.getElementById("nazev_kategorie").value;
    let typ_transakce = document.getElementById("typ_transakce").value;
    if (nazev === "") { alert("Zadejte název kategorie"); return; }

    kategorie.push(new Kategorie(nazev, typ_transakce));
    uloz();
    nacteni_kategorii();
  }

function pridej_polozku() {
  let nazev = document.getElementById("nazev_polozky").value;
  let castka = document.getElementById("castka").value;
  let kat = document.getElementById("kategorie_polozky").value || "";
  
  if (kat === "") { alert("Vyberte kategorii"); return; }

  let typ = (kategorie.find(k => k.nazev === kat) || {}).typ;  
  polozky.push(new Polozka(nazev, castka, typ, kat));

  uloz();
  vykresli_polozky();
}

  function smaz_polozku(i) {
    polozky.splice(i, 1);
    uloz();
    vykresli_polozky();
  }

  function smaz_kategorii(i) {
  kategorie.splice(i, 1);
  uloz();
  nacteni_kategorii();
}

  function vymazani_localstorage() {
  localStorage.clear();
  kategorie = [];
  polozky = [];
  nacteni_kategorii();
  vykresli_polozky();
}
  nacteni_kategorii();
  vykresli_polozky();

  let role = localStorage.getItem("role") || "uzivatel";
  document.getElementById("role").value = role;

function zmen_roli() {
  role = document.getElementById("role").value;
  localStorage.setItem("role", role);
  nastav_opravneni();
}

function nastav_opravneni() {
  document.querySelectorAll(".admin")
    .forEach(e => e.style.display = (role === "admin") ? "block" : "none");
}

nastav_opravneni();

</script>


</body>
</html>
